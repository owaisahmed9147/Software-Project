<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
</head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style>
    body {
	    font-family: Arial, sans-serif;
	    background-color: #f2f2f2;
	    margin: 0;
	    padding: 0;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    height: 100vh;
	}
	
	
	form {
	    background-color: #fff;
	    padding: 20px;
	    border-radius: 8px;
	    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	    width: 300px;
	    text-align: center;
	}
	
	label {
	    display: block;
	    margin-bottom: 8px;
	}
	
	input {
	    width: 100%;
	    padding: 8px;
	    margin-bottom: 16px;
	    box-sizing: border-box;
	    border: 1px solid #ccc;
	    border-radius: 4px;
	}
	
	button {
	    background-color: #4caf50;
	    color: #fff;
	    padding: 10px 20px;
	    border: none;
	    border-radius: 4px;
	    cursor: pointer;
	    font-size: 16px;
	    margin-right: 10px; /* Adjust spacing between buttons */
	}
	
	button:hover {
	    background-color: #45a049;
	}
	
	.card-header {
	    font-family: Arial, sans-serif;
	    background-color: lightgray;
	    font-size: large;
	    margin: 1.5em 4%;
	    padding: 3px;
	}
	
	.quote {
	    background-color: #f9f9f9;
	    border-left: 10px solid black;
	    margin: 1.5em 4%;
	    padding: 0.5em 10px;
	}
	
	.quote-text {
	    font-size: 1.125em;
	    line-height: 1.5;
	    margin: 0;
	}
	
	.quote-source {
	    font-size: 0.875em;
	    margin-top: 0.5em;
	}
	
</style>
<body>
    
    <div id="signup" hidden="hidden">
    	<h2>Signup</h2>
	    <label>Username:</label>
	    <input type="text" id="username" name="username" required>
	
	    <label>Email:</label>
	    <input type="email" id="signupemail" name="email" required>
	
	    <label>Password:</label>
	    <input type="password" id="signuppassword" name="password" required>
	
	    <button type="button" onclick="getsignup()">Sign Up</button>
    </div>
    
    <div id="login" hidden="hidden">
    	<h2>Login</h2>
	    <label>Email:</label>
	    <input type="email" id="loginemail" name="email" required>
	
	    <label>Password:</label>
	    <input type="password" id="loginpassword" name="password" required>
	
	    <button type="button" onclick="getlogin()">Log In</button>
	    
	    <div id="signuplink" class="signup-link" hidden="hidden" onclick="getpage()">Not a member? <a href="#">Signup now</a></div>
    </div>

	<div id="first">
		<h2>Welcome to Blog Website</h2>
		<button id="author" onclick="loginpage(1)">Author</button>
		<button id="editor" onclick="loginpage(2)">Editor</button>
		<button id="admin" onclick="loginpage(3)">Admin</button>
		<button id="user" onclick="loginpage(4)">User</button>
	</div>
	
    <div id="home" hidden="hidden">
    	
    	<button id="createbutton" hidden="hidden" onclick="handleButtonClick('create')">Create a New Blog</button>
	    <button id="addbutton" hidden="hidden" onclick="handleButtonClick('add')">Add New Editor</button>

    </div>
	<div id="blogContainer" hidden="hidden">
	<h2 style="align-items: center;">Blogs</h2>
	</div>
	
<script>

var parseXML;
if (typeof window.DOMParser != "undefined") {
	parseXML = function(xmlStr) {
	return ( new window.DOMParser() ).parseFromString(xmlStr, "text/xml");
};
} else if (typeof window.ActiveXObject != "undefined" && new window.ActiveXObject("Microsoft.XMLDOM")) {
	parseXML = function(xmlStr) {
	var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
	xmlDoc.async = "false";
	xmlDoc.loadXML(xmlStr);
	return xmlDoc;
};
} else {
	throw new Error("No XML parser found");
}

function loginpage(num){
	document.getElementById('first').remove();
	document.getElementById('login').removeAttribute('hidden');
	localStorage['num']=num;
	if(num==4){
		document.getElementById('signuplink').removeAttribute('hidden');
	}
}
function getpage(){
	document.getElementById('login').remove();
	document.getElementById('signup').removeAttribute('hidden');
}

function getlogin() {
	var num = localStorage['num'];
    l_username = document.getElementById('loginemail').value
    l_password = document.getElementById('loginpassword').value

    if(num==1){
	    query = "select author_id,author_username,author_password from author_info where author_username='"+l_username+"' and author_password='"+l_password+"'"    	
    }
    if(num==2){
    	query = "select editor_id,username,editor_password from editor_table where username='"+l_username+"' and editor_password='"+l_password+"'"
    }
    if(num==3){
    	query = "SELECT admin_id,username,admin_password FROM administrator WHERE username = '"+l_username+"' and admin_password = '"+l_password+"'"
    }
    if(num==4){
    	query = "SELECT User_ID,Username,password FROM user_table WHERE Username = '"+l_username+"' and password = '"+l_password+"'"
    }
    var myHeaders = new Headers();
    myHeaders.append("SOAPAction", "\"\"");
    myHeaders.append("Content-Type", "text/plain");

    var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <login_details xmlns="http://project">
            <query>${query}</query>
        </login_details>
    </Body>
</Envelope>`

    var requestOptions = {
      method: 'POST',
      headers: myHeaders,
      body: raw,
      redirect: 'follow'
    };
    
    fetch("http://localhost:8080/Blog_Web/services/Login", requestOptions)
        .then(response => response.text())
        .then(result => {
        	var xml = parseXML(result);

            var userIdNode = xml.getElementsByTagName("userid")[0];
            var usernameNode = xml.getElementsByTagName("username")[0];

            var userId = userIdNode ? userIdNode.textContent : 'N/A';
            var username = usernameNode ? usernameNode.textContent : 'N/A';
            
            if (userId != 'N/A') {
                console.log("ID: ", userId);
                console.log("Username: ", username);
                document.getElementById('login').remove();
                if(num!=4){
	                document.getElementById('home').removeAttribute('hidden');                	
                }
                showblogs(num);
            	document.getElementById('blogContainer').removeAttribute('hidden');
  			  	
            } 
            else {
                alert("Error: No user found with the provided username and password.");
            }
        })
        .catch(error => console.log('error', error));
}


function getsignup(){
	username = document.getElementById('username').value
	s_email = document.getElementById('signupemail').value
	s_password = document.getElementById('signuppassword').value
	
	
	var myHeaders = new Headers();
	myHeaders.append("SOAPAction", "\"\"");
	myHeaders.append("Content-Type", "text/plain");

	if(username!="" && s_email!="" && s_password!=""){
		var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
	    <Body>
	        <get_info_for_signup xmlns="http://project">
	            <name>${username}</name>
	            <email>${s_email}</email>
	            <password>${s_password}</password>
	        </get_info_for_signup>
	    </Body>
	</Envelope>`
	
		var requestOptions = {
		  method: 'POST',
		  headers: myHeaders,
		  body: raw,
		  redirect: 'follow'
		};
	
		fetch("http://localhost:8080/Blog_Web/services/Signup", requestOptions)
		  .then(response => response.text())
		  .then(result => {
			  console.log("data inserted");
			  document.getElementById('signup').remove();
			  showblogs(4);
          	  document.getElementById('blogContainer').removeAttribute('hidden');
		  })
		  .catch(error => console.log('error', error));		
	}
	else{
		alert('Fill Data First!!!');
	}
	
}


function showblogs(id){
	var myHeaders = new Headers();
	if(id!=2){
		var hide="hidden='hidden'";
	}
	else{
		var hide="";
	}
	if(id==3){
		document.getElementById('addbutton').removeAttribute('hidden');
	}
	if(id==1){
		document.getElementById('createbutton').removeAttribute('hidden');
	}
	myHeaders.append("SOAPAction", "\"\"");
	myHeaders.append("Content-Type", "text/plain");

	var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <show xmlns="http://project"/>
    </Body>
</Envelope>`

	var requestOptions = {
	  method: 'POST',
	  headers: myHeaders,
	  body: raw,
	  redirect: 'follow'
	};

	fetch("http://localhost:8080/Blog_Web/services/Showsblogs", requestOptions)
	  .then(response => response.text())
	  .then(result => {
		  var xml = parseXML(result);

          var blogEntries = xml.querySelectorAll('showReturn');

          var blogContainer = document.getElementById('blogContainer');
          blogEntries.forEach(function (blog, index) {
              var cardDiv = document.createElement('div');
              
              cardDiv.className = 'card';
              cardDiv.innerHTML = `
              	<div class="card-header">
                	Blog ${index + 1}
                </div>
                <div class="card-body">
                	<blockquote class="quote">
                    	<p class="quote-text">${blog.querySelector('title').textContent}</p>
                        <footer class="quote-source">${blog.querySelector('content').textContent}</footer>
                    	<div id="updatebutton" style="text-align: right;" ${hide}>
                    		<button type="button">Update</button>
                    	</div>
                    </blockquote>
                </div>
              `;
              
              blogContainer.appendChild(cardDiv);
          });
	  })

	  .catch(error => console.log('error', error));
}
</script>
</body>

</html>