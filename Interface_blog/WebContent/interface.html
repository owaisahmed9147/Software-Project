<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Blog Website</title>
</head>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style>
    body {
	    font-family: Arial, sans-serif;
	    background-color: #f2f2f2;
	    margin: 0;
	    padding: 0;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    height: 100vh;
	}
	
	
	form {
	    background-color: #fff;
	    padding: 20px;
	    border-radius: 8px;
	    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
	    width: 300px;
	    text-align: center;
	}
	
	label {
	    display: block;
	    margin-bottom: 8px;
	}
	
	input {
	    width: 100%;
	    padding: 8px;
	    margin-bottom: 16px;
	    box-sizing: border-box;
	    border: 1px solid #ccc;
	    border-radius: 4px;
	}
	
	button {
	    background-color: #4caf50;
	    color: #fff;
	    padding: 10px 20px;
	    border: none;
	    border-radius: 4px;
	    cursor: pointer;
	    font-size: 16px;
	    margin-right: 10px; /* Adjust spacing between buttons */
	}
	
	button:hover {
	    background-color: #45a049;
	}
	
	.card-header {
	    font-family: Arial, sans-serif;
	    background-color: lightgray;
	    font-size: large;
	    margin: 1.5em 4%;
	    padding: 3px;
	}
	
	.quote {
	    background-color: #f9f9f9;
	    border-left: 10px solid black;
	    margin: 1.5em 4%;
	    padding: 0.5em 10px;
	}
	
	.quote-text {
	    font-size: 1.125em;
	    line-height: 1.5;
	    margin: 0;
	}
	
	.quote-source {
	    font-size: 0.875em;
	    margin-top: 0.5em;
	}
	#blog-update-form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 400px;
            text-align: center;
        }

        #blog-update-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        #blog-update-form input,
        #blog-update-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #blog-update-form button {
            background-color: #4caf50;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #blog-update-form button:hover {
            background-color: #45a049;
        }
        
        #blog-form {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 400px;
        }

        #blog-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }

        #blog-form input,
        #blog-form textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #blog-form button {
            background-color: #4caf50;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        #blog-form button:hover {
            background-color: #45a049;
        }
</style>
<body>
    
    <div id="signup" hidden="hidden">
    	<h2>Signup</h2>
	    <label>Username:</label>
	    <input type="text" id="username" name="username" required>
	
	    <label>Email:</label>
	    <input type="email" id="signupemail" name="email" required>
	
	    <label>Password:</label>
	    <input type="password" id="signuppassword" name="password" required>
	
	    <button type="button" onclick="getsignup()">Sign Up</button>
    </div>
    
    <div id="login" hidden="hidden">
    	<h2>Login</h2>
	    <label>Username:</label>
	    <input type="email" id="loginemail" name="email" required>
	
	    <label>Password:</label>
	    <input type="password" id="loginpassword" name="password" required>
	
	    <button type="button" onclick="getlogin()">Log In</button>
	    
	    <div id="signuplink" class="signup-link" hidden="hidden" onclick="getpage()">Not a member? <a href="#">Signup now</a></div>
    </div>

	<div id="first">
		<h2>Welcome to Blog Website</h2>
		<button id="author" onclick="login_author()">Author</button>
		<button id="editor" onclick="login_editor()">Editor</button>
		<button id="admin" onclick="login_admin()">Admin</button>
		<button id="user" onclick="login_user()">User</button>
	</div>
	
    <div id="home" hidden="hidden">
    	
    	<button id="createbutton" hidden="hidden" onclick="blog_edit()">Create a New Blog</button>
	    <button id="addbutton" hidden="hidden" onclick="add()">Add New Editor</button>

    </div>
	
	<div id="blogContainer" hidden="hidden">
	<h2 style="align-items: center;">Blogs</h2>
	</div>
	
	<div id="blog-update-form" hidden="hidden">
        <h2>Update Blog</h2>
        <form action="#" method="post" onsubmit="updateBlog(); return false;">

            <label for="blogTitle">Blog Title:</label>
            <input type="text" id="blog-Title" name="blogTitle" required>

            <label for="blogContent">Blog Content:</label>
            <textarea id="blog-Content" name="blogContent" rows="8" required></textarea>

            <button type="submit">Update Blog</button>
        </form>
    </div>
    
    <div id="blog-form" hidden="hidden">
        <h2>Create a New Blog Post</h2>
        <form action="#" method="post" onsubmit="blog_editing(); return false;">
            <label for="blogTitle">Blog Title:</label>
            <input type="text" id="blogTitle" name="blogTitle" required>

            <label for="blogContent">Blog Content:</label>
            <textarea id="blogContent" name="blogContent" rows="8" required></textarea>

            <button type="submit">Submit</button>
        </form>
    </div>
    
    
    <div id="Add" hidden="hidden">
    	<h2>Add Editor</h2>
	    <label>User Name:</label>
	    <input type="text" id="Username" name="text" required>
	
	    <label>Password:</label>
	    <input type="password" id="password" name="password" required>
	    
	    <label>Type:</label>
	    <input type="text" id="type" name="text" required>
	    
	
	    <button type="button" onclick="addEditor()">Add</button>
	    
 </div>
<script>

var parseXML;
if (typeof window.DOMParser != "undefined") {
	parseXML = function(xmlStr) {
	return ( new window.DOMParser() ).parseFromString(xmlStr, "text/xml");
};
} else if (typeof window.ActiveXObject != "undefined" && new window.ActiveXObject("Microsoft.XMLDOM")) {
	parseXML = function(xmlStr) {
	var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
	xmlDoc.async = "false";
	xmlDoc.loadXML(xmlStr);
	return xmlDoc;
};
} else {
	throw new Error("No XML parser found");
}

function getpage(){
	document.getElementById('login').remove();
	document.getElementById('signup').removeAttribute('hidden');
}
function getsignup(){
	username = document.getElementById('username').value
	s_email = document.getElementById('signupemail').value
	s_password = document.getElementById('signuppassword').value
	
	
	var myHeaders = new Headers();
	myHeaders.append("SOAPAction", "\"\"");
	myHeaders.append("Content-Type", "text/plain");

	if(username!="" && s_email!="" && s_password!=""){
		var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
	    <Body>
	        <get_info_for_signup xmlns="http://project">
	            <name>${username}</name>
	            <email>${s_email}</email>
	            <password>${s_password}</password>
	        </get_info_for_signup>
	    </Body>
	</Envelope>`
	
		var requestOptions = {
		  method: 'POST',
		  headers: myHeaders,
		  body: raw,
		  redirect: 'follow'
		};
	
		fetch("http://localhost:8080/Blog_Web/services/Signup", requestOptions)
		  .then(response => response.text())
		  .then(result => {
			  console.log("data inserted");
			  document.getElementById('signup').remove();
			  showblogs(4);
          	  document.getElementById('blogContainer').removeAttribute('hidden');
		  })
		  .catch(error => console.log('error', error));		
	}
	else{
		alert('Fill Data First!!!');
	}
	
}

function login_author(){
	document.getElementById('first').remove();
	document.getElementById('login').removeAttribute('hidden');
	localStorage['num']=1;
}
function login_editor(){
	document.getElementById('first').remove();
	document.getElementById('login').removeAttribute('hidden');
	localStorage['num']=2
}
function login_admin(){
	document.getElementById('first').remove();
	document.getElementById('login').removeAttribute('hidden');
	localStorage['num']=3;
}
function login_user(){
	document.getElementById('first').remove();
	document.getElementById('login').removeAttribute('hidden');
	localStorage['num']=4
	document.getElementById('signuplink').removeAttribute('hidden');
}


function getlogin() {
	var num = localStorage['num'];
	console.log(num);
    l_username = document.getElementById('loginemail').value
    l_password = document.getElementById('loginpassword').value

    if(num==1){
	    
    	var myHeaders = new Headers();
	    myHeaders.append("SOAPAction", "\"\"");
	    myHeaders.append("Content-Type", "text/plain");

	    var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
	        <Body>
	        <loginauthor xmlns="http://Project">
	            <Username>${l_username}</Username>
	            <password>${l_password}</password>
	        </loginauthor>
	    </Body>
	</Envelope>`
		
	    var requestOptions = {
	      method: 'POST',
	      headers: myHeaders,
	      body: raw,
	      redirect: 'follow'
	    };

	    fetch("http://localhost:8080/Blog_Web/services/Login_Author", requestOptions)
	      .then(response => response.text())
	      .then(result => {
	    	  var xml = parseXML(result);

	            var userIdNode = xml.getElementsByTagName("userid")[0];
	            var usernameNode = xml.getElementsByTagName("username")[0];

	            var userId = userIdNode ? userIdNode.textContent : 'N/A';
	            var username = usernameNode ? usernameNode.textContent : 'N/A';
	            
	            if (userId != 'N/A') {
	            	localStorage['authorid']=userId;
	                console.log("ID: ", userId);
	                console.log("Username: ", username);
	                document.getElementById('login').remove();
	                showblogs(num);
	                document.getElementById('blogContainer').removeAttribute('hidden');
	            } 
	            else {
	                alert("Error: No Author found with the provided username and password.");
	            }
	      })
	      .catch(error => console.log('error', error));
    }
    else if(num==2){
    	var myHeaders = new Headers();
    	myHeaders.append("SOAPAction", "\"\"");
    	myHeaders.append("Content-Type", "text/plain");

    	var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    	    <Body>
            <logineditor xmlns="http://Project">
                <Username>${l_username}</Username>
                <password>${l_password}</password>
            </logineditor>
        </Body>
    </Envelope>`

    	var requestOptions = {
    	  method: 'POST',
    	  headers: myHeaders,
    	  body: raw,
    	  redirect: 'follow'
    	};

    	fetch("http://localhost:8080/Blog_Web/services/Login_Editor", requestOptions)
    	  .then(response => response.text())
    	  .then(result => {
    		  var xml = parseXML(result);

	            var userIdNode = xml.getElementsByTagName("userid")[0];
	            var usernameNode = xml.getElementsByTagName("username")[0];

	            var userId = userIdNode ? userIdNode.textContent : 'N/A';
	            var username = usernameNode ? usernameNode.textContent : 'N/A';
	            
	            if (userId != 'N/A') {
	                console.log("ID: ", userId);
	                console.log("Username: ", username);
	                document.getElementById('login').remove();
	                showblogs(num);
	            	document.getElementById('blogContainer').removeAttribute('hidden');
	            } 
	            else {
	                alert("Error: No Editor found with the provided username and password.");
	            }
    	  })
    	  .catch(error => console.log('error', error));
    }
    else if(num==3){
    	var myHeaders = new Headers();
    	myHeaders.append("SOAPAction", "\"\"");
    	myHeaders.append("Content-Type", "text/plain");

    	var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    	    <Body>
            <loginadmin xmlns="http://Project">
                <Username>${l_username}</Username>
                <password>${l_password}</password>
            </loginadmin>
        </Body>
    </Envelope>`

    	var requestOptions = {
    	  method: 'POST',
    	  headers: myHeaders,
    	  body: raw,
    	  redirect: 'follow'
    	};

    	fetch("http://localhost:8080/Blog_Web/services/Login_Admin", requestOptions)
    	  .then(response => response.text())
    	  .then(result => {
    		  var xml = parseXML(result);

	            var userIdNode = xml.getElementsByTagName("userid")[0];
	            var usernameNode = xml.getElementsByTagName("username")[0];

	            var userId = userIdNode ? userIdNode.textContent : 'N/A';
	            var username = usernameNode ? usernameNode.textContent : 'N/A';
	            
	            if (userId != 'N/A') {
	                console.log("ID: ", userId);
	                console.log("Username: ", username);
	                document.getElementById('login').remove();
	                showblogs(num);
	            	document.getElementById('blogContainer').removeAttribute('hidden');
	            } 
	            else {
	                alert("Error: No Admin found with the provided username and password.");
	            }
    	  })
    	  .catch(error => console.log('error', error));
    }
    else if(num==4){
    	var myHeaders = new Headers();
    	myHeaders.append("SOAPAction", "\"\"");
    	myHeaders.append("Content-Type", "text/plain");

    	var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    	    <Body>
            <loginuser xmlns="http://Project">
                <Username>${l_username}</Username>
                <password>${l_password}</password>
            </loginuser>
        </Body>
    </Envelope>`

    	var requestOptions = {
    	  method: 'POST',
    	  headers: myHeaders,
    	  body: raw,
    	  redirect: 'follow'
    	};

    	fetch("http://localhost:8080/Blog_Web/services/Login_User", requestOptions)
    	  .then(response => response.text())
    	  .then(result => {
    		  var xml = parseXML(result);

	            var userIdNode = xml.getElementsByTagName("userid")[0];
	            var usernameNode = xml.getElementsByTagName("username")[0];

	            var userId = userIdNode ? userIdNode.textContent : 'N/A';
	            var username = usernameNode ? usernameNode.textContent : 'N/A';
	            
	            if (userId != 'N/A') {
	                console.log("ID: ", userId);
	                console.log("Username: ", username);
	                document.getElementById('login').remove();
	                showblogs(num);
	            	document.getElementById('blogContainer').removeAttribute('hidden');
	            } 
	            else {
	                alert("Error: No Admin found with the provided username and password.");
	            }
    	  })
    	  .catch(error => console.log('error', error));
    }
    document.getElementById('home').removeAttribute('hidden');
}



function showblogs(id){
	if(id!=2){
		var hide="hidden='hidden'";
	}
	else{
		var hide="";
	}
	if(id==3){
		document.getElementById('addbutton').removeAttribute('hidden');
	}
	if(id==1){
		document.getElementById('createbutton').removeAttribute('hidden');
	}
	var myHeaders = new Headers();
	myHeaders.append("SOAPAction", "\"\"");
	myHeaders.append("Content-Type", "text/plain");

	var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <show xmlns="http://Project"/>
    </Body>
</Envelope>`

	var requestOptions = {
	  method: 'POST',
	  headers: myHeaders,
	  body: raw,
	  redirect: 'follow'
	};

	fetch("http://localhost:8080/Blog_Web/services/Showsblogs", requestOptions)
	  .then(response => response.text())
	  .then(result => {
		  var xml = parseXML(result);

          var blogEntries = xml.querySelectorAll('showReturn');

          var blogContainer = document.getElementById('blogContainer');
          blogEntries.forEach(function (blog, index) {
              var cardDiv = document.createElement('div');
              
              cardDiv.className = 'card';
              cardDiv.innerHTML = `
              	<div class="card-header">
                	Blog ${index + 1}
                </div>
                <div class="card-body">
                	<blockquote class="quote">
                    	<p class="quote-text">${blog.querySelector('title').textContent}</p>
                        <footer class="quote-source">${blog.querySelector('content').textContent}</footer>
                    	<div id="updatebutton" style="text-align: right;" ${hide} onclick="updatebutton(${blog.querySelector('post_id').textContent})">
                    		<button type="button">Update</button>
                    	</div>
                    </blockquote>
                </div>
              `;
              
              blogContainer.appendChild(cardDiv);
          });
	  })

	  .catch(error => console.log('error', error));
}

function updatebutton(postid){
	document.getElementById('blog-update-form').removeAttribute('hidden');
	localStorage['post']=postid;
	document.getElementById('blogContainer').remove();
}

function updateBlog() {
	var post= localStorage['post'];
	
	var myHeaders = new Headers();
	    myHeaders.append("SoapAction", "\"\"");
	    myHeaders.append("Content-Type", "text/plain");
	    // Get values from input fields
	    //var postId = document.getElementById("postId").value;
	    var newTitle = document.getElementById("blog-Title").value;
	    var newContent = document.getElementById("blog-Content").value;

	    var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
	        <Body>
	            <blog_updating xmlns="http://Project">
	                <ID>${post}</ID>
	                <newTitle>${newTitle}</newTitle>
	                <newContent>${newContent}</newContent>
	            </blog_updating>
	        </Body>
	    </Envelope>`;

	    var requestOptions = {
	      method: 'POST',
	      headers: myHeaders,
	      body: raw,
	      redirect: 'follow'
	    };

	    fetch("http://localhost:8080/Blog_Web/services/blog_update", requestOptions)
	      .then(response => response.text())
	      .then(result => console.log(result))
	      .catch(error => console.log('error', error));
}

function blog_edit(){
	document.getElementById('blog-form').removeAttribute('hidden');
	document.getElementById('blogContainer').remove();
	document.getElementById('home').remove();
}
function blog_editing() {
    var myHeaders = new Headers();
    myHeaders.append("SoapAction", "\"\"");
    myHeaders.append("Content-Type", "text/plain");

    // Get values from input fields
    var authorId = localStorage['authorid']
    var blogTitle = document.getElementById("blogTitle").value;
    var blogContent = document.getElementById("blogContent").value;

    var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
        <Body>
            <blog_posting xmlns="http://project">
                <ID>${authorId}</ID>
                <title>${blogTitle}</title>
                <content>${blogContent}</content>
            </blog_posting>
        </Body>
    </Envelope>`;

    var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
    };

    fetch("http://localhost:8080/Blog_Web/services/blog_post", requestOptions)
        .then(response => response.text())
        .then(result => {
            console.log(result);
        })
        .catch(error => console.log('error', error));
}

function add(){
	document.getElementById('Add').removeAttribute('hidden');
	document.getElementById('blogContainer').remove();
	document.getElementById('home').remove();
}

function addEditor(){
	
	username = document.getElementById('Username').value;
	password = document.getElementById('password').value;
	type = document.getElementById('type').value;
	
	var myHeaders = new Headers();
	myHeaders.append("SOAPAction", "\"\"");
	myHeaders.append("Content-Type", "application/json");

	var raw = `<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/">
    <Body>
        <getInfoForAdding xmlns="http://Project">
            <username>${username}</username>
        	<password>${password}</password>
            <type>${type}</type>
        </getInfoForAdding>
    </Body>
</Envelope>`;

	var requestOptions = {
	  method: 'POST',
	  headers: myHeaders,
	  body: raw,
	  redirect: 'follow'
	};

	fetch("http://localhost:8080/Blog_Web/services/Add_Editor", requestOptions)
	  .then(response => response.text())
	  .then(result => console.log(result))
	  .catch(error => console.log('error', error));
	
}

</script>
</body>

</html>